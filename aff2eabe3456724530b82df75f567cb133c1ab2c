{
  "comments": [
    {
      "key": {
        "uuid": "4eba6044_e875d654",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/reviewersbyblame/ChangeUpdatedListener.java",
        "patchSetId": 1
      },
      "lineNbr": 201,
      "author": {
        "id": 1010008
      },
      "writtenOn": "2018-08-09T16:56:32Z",
      "side": 1,
      "message": "I would recommend injecting a ChangeData.Factory and directly looking up the change in NoteDb using the (project, change number), both of which should be available somewhere in the event. That should be faster and more correct than making an index query.",
      "revId": "aff2eabe3456724530b82df75f567cb133c1ab2c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ee08c913_2c56113c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/reviewersbyblame/ChangeUpdatedListener.java",
        "patchSetId": 1
      },
      "lineNbr": 201,
      "author": {
        "id": 1019767
      },
      "writtenOn": "2018-08-09T21:49:26Z",
      "side": 1,
      "message": "Thanks for the feedback, will switch it around tomorrow.\n\nOut of curiosity, can you elaborate on what you mean by \"more correct\"?\n\nIs there an instance where the existing query might return more than one result? We have code in CI scripts that tend to presume that given change id (I....) with a given target branch should only exist (at most) once for a given project/repository. Is this not correct?",
      "parentUuid": "4eba6044_e875d654",
      "revId": "aff2eabe3456724530b82df75f567cb133c1ab2c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36a9c37d_fb5e39ed",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/reviewersbyblame/ChangeUpdatedListener.java",
        "patchSetId": 1
      },
      "lineNbr": 201,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2018-08-10T06:31:27Z",
      "side": 1,
      "message": "\u003e Out of curiosity, can you elaborate on what you mean by \"more correct\"?\n\nThe index is a secondary storage for change data. It is created from the change data in the primary storage (NoteDb or ReviewDb). Data in the index may be stale (e.g. if reindexing a change after an update fails). This means looking at the primary storage you are always sure to see the actual state of the change, while looking at the index you may see outdated data.\n\n\u003e Is there an instance where the existing query might return more than one result?\n\u003e We have code in CI scripts that tend to presume that given change id (I....) with\n\u003e a given target branch should only exist (at most) once for a given \n\u003e project/repository. Is this not correct?\n\nThis is generally true. However at Google we sometimes have the situation that there are 2 changes with the same Change-Id + branch in the same project/repo. This happens due to races in our multimaster setup (commits with the same Change-Id are pushed in parallel but to different server nodes). So standard upstream Gerrit should not be effected by this, but it may happen on multimaster setups.\n\nWith NoteDb using project + change number as a change identifier is generally preferred over using Change-Id + branch + project. With project + change number Gerrit can lookup the change information directly from NoteDb, while with Change-Id + branch + project Gerrit first needs to do an index query to resolve the change identifier, and the index may be stale.",
      "parentUuid": "ee08c913_2c56113c",
      "revId": "aff2eabe3456724530b82df75f567cb133c1ab2c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8ed0416_144d39ed",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/reviewersbyblame/ChangeUpdatedListener.java",
        "patchSetId": 1
      },
      "lineNbr": 201,
      "author": {
        "id": 1019767
      },
      "writtenOn": "2018-08-10T08:46:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "36a9c37d_fb5e39ed",
      "revId": "aff2eabe3456724530b82df75f567cb133c1ab2c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}